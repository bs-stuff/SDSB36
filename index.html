<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <title>Stop SB 36 - Insurance Agents Take Action</title>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@400;500;600;700;800&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAz7sOz7lAaC1ImZMCnPu9yoTvcbBvTt3A&libraries=places"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --red-dark: #8b1a1a;
            --red-mid: #b22222;
            --red-light: #cd5c5c;
            --orange-accent: #e87a3d;
            --cream: #faf8f5;
            --cream-dark: #f0ebe3;
            --text-dark: #1a1a1a;
            --text-mid: #4a4a4a;
            --blue-pro: #1e4a6d;
            --blue-light: #3a7ca5;
        }

        body {
            font-family: 'Outfit', sans-serif;
            background: var(--cream);
            color: var(--text-dark);
            min-height: 100vh;
            line-height: 1.5;
        }

        .app-container {
            max-width: 800px;
            margin: 0 auto;
            padding: 1.5rem 1rem 3rem;
        }

        /* Compact Header */
        .header {
            text-align: center;
            margin-bottom: 1.5rem;
            padding-bottom: 1rem;
            border-bottom: 2px solid var(--red-dark);
        }

        .header h1 {
            font-size: 1.8rem;
            font-weight: 800;
            color: var(--red-dark);
            margin-bottom: 0.25rem;
        }

        .header p {
            color: var(--text-mid);
            font-size: 0.95rem;
        }

        .bill-badge {
            display: inline-block;
            background: var(--red-dark);
            color: white;
            padding: 0.25rem 0.75rem;
            border-radius: 50px;
            font-weight: 600;
            font-size: 0.8rem;
            margin-bottom: 0.5rem;
        }

        /* Compact Alert */
        .alert-box {
            background: #fff5f5;
            border-left: 4px solid var(--red-dark);
            border-radius: 8px;
            padding: 0.75rem 1rem;
            margin-bottom: 1.5rem;
            font-size: 0.85rem;
        }

        .alert-box strong {
            color: var(--red-dark);
        }

        /* Steps - more compact */
        .steps {
            display: flex;
            justify-content: center;
            gap: 0.5rem;
            margin-bottom: 1.5rem;
        }

        .step {
            display: flex;
            align-items: center;
            gap: 0.35rem;
            padding: 0.4rem 0.75rem;
            background: white;
            border-radius: 50px;
            font-size: 0.8rem;
            font-weight: 500;
            color: var(--text-mid);
            border: 2px solid var(--cream-dark);
        }

        .step.active {
            background: var(--red-dark);
            color: white;
            border-color: var(--red-dark);
        }

        .step.completed {
            background: var(--blue-pro);
            color: white;
            border-color: var(--blue-pro);
        }

        .step-num {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: var(--cream-dark);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            font-size: 0.7rem;
        }

        .step.active .step-num,
        .step.completed .step-num {
            background: rgba(255,255,255,0.25);
        }

        /* Cards */
        .card {
            background: white;
            border-radius: 12px;
            padding: 1.25rem;
            box-shadow: 0 2px 12px rgba(0,0,0,0.06);
            margin-bottom: 1rem;
        }

        .card-header {
            margin-bottom: 1rem;
        }

        .card-header h2 {
            font-size: 1.15rem;
            font-weight: 700;
            color: var(--red-dark);
            margin-bottom: 0.15rem;
        }

        .card-header p {
            color: var(--text-mid);
            font-size: 0.85rem;
        }

        /* Tab buttons */
        .tab-row {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 1rem;
        }

        .tab-btn {
            flex: 1;
            padding: 0.75rem;
            border: 2px solid var(--cream-dark);
            border-radius: 8px;
            font-family: 'Outfit', sans-serif;
            font-weight: 600;
            font-size: 0.85rem;
            cursor: pointer;
            background: white;
            color: var(--text-mid);
            transition: all 0.15s ease;
        }

        .tab-btn.active {
            background: var(--blue-pro);
            color: white;
            border-color: var(--blue-pro);
        }

        .tab-btn:hover:not(.active) {
            border-color: var(--blue-light);
        }

        /* Form elements */
        .form-group {
            margin-bottom: 1rem;
        }

        .form-group label {
            display: block;
            font-weight: 600;
            margin-bottom: 0.35rem;
            font-size: 0.9rem;
        }

        input[type="text"],
        input[type="tel"] {
            width: 100%;
            padding: 0.75rem 1rem;
            font-size: 1rem;
            font-family: 'JetBrains Mono', monospace;
            border: 2px solid var(--cream-dark);
            border-radius: 8px;
            background: var(--cream);
        }

        input:focus {
            outline: none;
            border-color: var(--blue-light);
            background: white;
        }

        input::placeholder {
            font-family: 'Outfit', sans-serif;
            color: #aaa;
        }

        select {
            width: 100%;
            padding: 0.75rem 1rem;
            font-size: 1rem;
            font-family: 'Outfit', sans-serif;
            border: 2px solid var(--cream-dark);
            border-radius: 8px;
            background: var(--cream);
            cursor: pointer;
        }

        .input-hint {
            font-size: 0.8rem;
            color: var(--text-mid);
            margin-top: 0.35rem;
        }

        .error-message {
            color: var(--red-mid);
            font-size: 0.85rem;
            margin-top: 0.35rem;
        }

        /* Buttons */
        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 0.4rem;
            padding: 0.75rem 1.5rem;
            font-size: 0.95rem;
            font-weight: 600;
            font-family: 'Outfit', sans-serif;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.15s ease;
        }

        .btn-primary {
            background: var(--red-dark);
            color: white;
        }

        .btn-primary:hover {
            background: var(--red-mid);
        }

        .btn-secondary {
            background: var(--cream);
            color: var(--red-dark);
            border: 2px solid var(--red-dark);
        }

        .btn-send {
            background: var(--blue-pro);
            color: white;
            width: 100%;
            padding: 1rem;
            font-size: 1rem;
        }

        .btn-send:hover {
            background: var(--blue-light);
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        /* Compact committee grid */
        .committee-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
            gap: 0.5rem;
        }

        .member-chip {
            display: flex;
            align-items: center;
            gap: 0.6rem;
            padding: 0.6rem 0.75rem;
            border-radius: 8px;
            border: 2px solid var(--cream-dark);
            background: white;
            cursor: pointer;
            transition: all 0.15s ease;
        }

        .member-chip:hover {
            border-color: var(--blue-light);
        }

        .member-chip.selected {
            background: var(--blue-pro);
            border-color: var(--blue-pro);
            color: white;
        }

        .chip-check {
            width: 18px;
            height: 18px;
            border-radius: 4px;
            border: 2px solid var(--cream-dark);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.7rem;
            font-weight: bold;
            flex-shrink: 0;
        }

        .member-chip.selected .chip-check {
            background: white;
            border-color: white;
            color: var(--blue-pro);
        }

        .chip-info {
            flex: 1;
            min-width: 0;
        }

        .chip-name {
            font-weight: 600;
            font-size: 0.85rem;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .chip-role {
            font-size: 0.7rem;
            opacity: 0.75;
        }

        /* District legislator cards - slightly larger */
        .district-grid {
            display: grid;
            gap: 0.6rem;
        }

        .leg-card {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.85rem;
            background: var(--cream);
            border-radius: 10px;
            border: 2px solid transparent;
            cursor: pointer;
        }

        .leg-card:hover {
            border-color: var(--blue-light);
        }

        .leg-card.selected {
            background: var(--blue-pro);
            color: white;
        }

        .leg-avatar {
            width: 44px;
            height: 44px;
            border-radius: 50%;
            background: var(--blue-pro);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 1rem;
            flex-shrink: 0;
        }

        .leg-card.selected .leg-avatar {
            background: var(--blue-light);
        }

        .leg-info { flex: 1; }

        .leg-name {
            font-weight: 600;
            font-size: 1rem;
        }

        .leg-role {
            font-size: 0.8rem;
            opacity: 0.8;
        }

        .leg-party {
            padding: 0.2rem 0.5rem;
            border-radius: 50px;
            font-size: 0.75rem;
            font-weight: 600;
            background: rgba(0,0,0,0.1);
        }

        .leg-card.selected .leg-party {
            background: rgba(255,255,255,0.2);
        }

        /* Select all row */
        .select-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.75rem;
            font-size: 0.85rem;
        }

        .select-all-btn {
            padding: 0.4rem 0.75rem;
            font-size: 0.8rem;
            font-weight: 600;
            font-family: 'Outfit', sans-serif;
            border: 2px solid var(--blue-pro);
            border-radius: 6px;
            background: white;
            color: var(--blue-pro);
            cursor: pointer;
        }

        .select-all-btn:hover {
            background: var(--blue-pro);
            color: white;
        }

        /* Template cards - compact */
        .template-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
            gap: 0.5rem;
        }

        .template-card {
            padding: 0.75rem;
            border: 2px solid var(--cream-dark);
            border-radius: 8px;
            cursor: pointer;
            background: white;
            transition: all 0.15s ease;
        }

        .template-card:hover {
            border-color: var(--blue-light);
        }

        .template-card.selected {
            border-color: var(--blue-pro);
            background: rgba(30, 74, 109, 0.05);
        }

        .template-icon {
            font-size: 1.25rem;
            margin-bottom: 0.25rem;
        }

        .template-name {
            font-weight: 600;
            font-size: 0.85rem;
        }

        .template-desc {
            font-size: 0.75rem;
            color: var(--text-mid);
            line-height: 1.3;
            margin-top: 0.25rem;
        }

        /* Nav buttons */
        .nav-row {
            display: flex;
            gap: 0.75rem;
            margin-top: 1.25rem;
        }

        .nav-row .btn { flex: 1; }

        /* Message preview */
        .preview-box {
            background: var(--cream);
            border-radius: 8px;
            padding: 1rem;
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.8rem;
            line-height: 1.6;
            white-space: pre-wrap;
            max-height: 200px;
            overflow-y: auto;
            margin-top: 0.5rem;
        }

        /* Recipients chips */
        .recipients-row {
            display: flex;
            flex-wrap: wrap;
            gap: 0.35rem;
            margin-bottom: 1rem;
        }

        .recipient-chip {
            padding: 0.25rem 0.5rem;
            background: var(--blue-pro);
            color: white;
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: 500;
        }

        /* District badge */
        .district-badge {
            display: inline-block;
            padding: 0.35rem 0.75rem;
            background: var(--blue-pro);
            color: white;
            border-radius: 50px;
            font-weight: 600;
            font-size: 0.85rem;
            margin-bottom: 0.75rem;
        }

        /* Footer */
        footer {
            text-align: center;
            margin-top: 2rem;
            color: var(--text-mid);
            font-size: 0.8rem;
        }

        footer a { color: var(--blue-pro); }

        /* Reset link */
        .reset-link {
            display: block;
            text-align: center;
            margin-top: 1rem;
            color: var(--text-mid);
            font-size: 0.85rem;
            cursor: pointer;
        }

        .reset-link:hover { color: var(--red-dark); }

        /* Two-column form */
        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 0.75rem;
        }

        /* Mobile adjustments */
        @media (max-width: 600px) {
            .app-container { padding: 1rem 0.75rem 2rem; }
            .header h1 { font-size: 1.5rem; }
            .header p { font-size: 0.85rem; }
            .card { padding: 1rem; }
            .card-header h2 { font-size: 1.05rem; }
            .steps { gap: 0.25rem; }
            .step { padding: 0.35rem 0.5rem; font-size: 0.7rem; }
            .step-num { width: 16px; height: 16px; font-size: 0.6rem; }
            .tab-row { flex-direction: column; }
            .form-row { grid-template-columns: 1fr; }
            .committee-grid { grid-template-columns: 1fr 1fr; }
            .template-grid { grid-template-columns: 1fr 1fr; }
            .nav-row { flex-direction: column-reverse; }
        }

        @media (max-width: 400px) {
            .committee-grid { grid-template-columns: 1fr; }
        }

        /* Loading */
        .spinner {
            width: 24px;
            height: 24px;
            border: 2px solid var(--cream-dark);
            border-top-color: var(--red-dark);
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
            margin: 0 auto;
        }

        @keyframes spin { to { transform: rotate(360deg); } }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // SD Legislators (2026)
        const legislators = {
            1: { members: [
                { name: "Michael Rohl", party: "R", email: "michael.rohl@sdlegislature.gov", chamber: "Senate" },
                { name: "Nick Fosness", party: "R", email: "nick.fosness@sdlegislature.gov", chamber: "House" },
                { name: "Logan Manhart", party: "R", email: "logan.manhart@sdlegislature.gov", chamber: "House" },
            ]},
            2: { members: [
                { name: "John Sjaarda", party: "R", email: "john.sjaarda@sdlegislature.gov", chamber: "House" },
                { name: "Steve Kolbeck", party: "R", email: "steve.kolbeck@sdlegislature.gov", chamber: "Senate" },
                { name: "David Kull", party: "R", email: "david.kull@sdlegislature.gov", chamber: "House" },
            ]},
            3: { members: [
                { name: "Al Novstrup", party: "R", email: "al.novstrup@sdlegislature.gov", chamber: "House" },
                { name: "Carl Perry", party: "R", email: "carl.perry@sdlegislature.gov", chamber: "Senate" },
                { name: "Brandei Schaefbauer", party: "R", email: "brandei.schaefbauer@sdlegislature.gov", chamber: "House" },
            ]},
            4: { members: [
                { name: "Stephanie Sauder", party: "R", email: "stephanie.sauder@sdlegislature.gov", chamber: "Senate" },
                { name: "Dylan Jordan", party: "R", email: "dylan.jordan@sdlegislature.gov", chamber: "House" },
                { name: "Kent Roe", party: "R", email: "kent.roe@sdlegislature.gov", chamber: "House" },
            ]},
            5: { members: [
                { name: "Glen Vilhauer", party: "R", email: "glen.vilhauer@sdlegislature.gov", chamber: "Senate" },
                { name: "Josephine Garcia", party: "R", email: "josephine.garcia@sdlegislature.gov", chamber: "House" },
                { name: "Matt Roby", party: "R", email: "matt.roby@sdlegislature.gov", chamber: "House" },
            ]},
            6: { members: [
                { name: "Ernie Otten", party: "R", email: "ernie.otten@sdlegislature.gov", chamber: "Senate" },
                { name: "Aaron Aylward", party: "R", email: "aaron.aylward@sdlegislature.gov", chamber: "House" },
                { name: "Tim Czmowski", party: "R", email: "tim.czmowski@sdlegislature.gov", chamber: "House" },
            ]},
            7: { members: [
                { name: "Tim Reed", party: "R", email: "tim.reed@sdlegislature.gov", chamber: "Senate" },
                { name: "Roger DeGroot", party: "R", email: "roger.degroot@sdlegislature.gov", chamber: "House" },
                { name: "Mellissa Heermann", party: "R", email: "mellissa.heermann@sdlegislature.gov", chamber: "House" },
            ]},
            8: { members: [
                { name: "Casey Crabtree", party: "R", email: "casey.crabtree@sdlegislature.gov", chamber: "Senate" },
                { name: "Tim Reisch", party: "R", email: "tim.reisch@sdlegislature.gov", chamber: "House" },
                { name: "Tim Walburg", party: "R", email: "tim.walburg@sdlegislature.gov", chamber: "House" },
            ]},
            9: { members: [
                { name: "Bethany Soye", party: "R", email: "bethany.soye@sdlegislature.gov", chamber: "House" },
                { name: "Joy Hohn", party: "R", email: "joy.hohn@sdlegislature.gov", chamber: "Senate" },
                { name: "Tesa Schwans", party: "R", email: "tesa.schwans@sdlegislature.gov", chamber: "House" },
            ]},
            10: { members: [
                { name: "Liz Larson", party: "D", email: "liz.larson@sdlegislature.gov", chamber: "Senate" },
                { name: "Bobbi Andera", party: "D", email: "bobbi.andera@sdlegislature.gov", chamber: "House" },
                { name: "Erin Healy", party: "D", email: "erin.healy@sdlegislature.gov", chamber: "House" },
            ]},
            11: { members: [
                { name: "Chris Karr", party: "R", email: "chris.karr@sdlegislature.gov", chamber: "Senate" },
                { name: "Brian Mulder", party: "R", email: "brian.mulder@sdlegislature.gov", chamber: "House" },
                { name: "Keri Weems", party: "R", email: "keri.weems@sdlegislature.gov", chamber: "House" },
            ]},
            12: { members: [
                { name: "Arch Beal", party: "R", email: "arch.beal@sdlegislature.gov", chamber: "Senate" },
                { name: "Amber Arlint", party: "R", email: "amber.arlint@sdlegislature.gov", chamber: "House" },
                { name: "Greg Jamison", party: "R", email: "greg.jamison@sdlegislature.gov", chamber: "House" },
            ]},
            13: { members: [
                { name: "Jack Kolbeck", party: "R", email: "jack.kolbeck@sdlegislature.gov", chamber: "House" },
                { name: "John Hughes", party: "R", email: "john.hughes@sdlegislature.gov", chamber: "House" },
                { name: "Sue Peterson", party: "R", email: "sue.peterson@sdlegislature.gov", chamber: "Senate" },
            ]},
            14: { members: [
                { name: "Larry Zikmund", party: "R", email: "larry.zikmund@sdlegislature.gov", chamber: "Senate" },
                { name: "Tony Kayser", party: "R", email: "tony.kayser@sdlegislature.gov", chamber: "House" },
                { name: "Taylor Rehfeldt", party: "R", email: "taylor.rehfeldt@sdlegislature.gov", chamber: "House" },
            ]},
            15: { members: [
                { name: "Kadyn Wittman", party: "D", email: "kadyn.wittman@sdlegislature.gov", chamber: "House" },
                { name: "Erik Muckey", party: "D", email: "erik.muckey@sdlegislature.gov", chamber: "House" },
                { name: "Jamie Smith", party: "D", email: "jamie.smith@sdlegislature.gov", chamber: "Senate" },
            ]},
            16: { members: [
                { name: "Kevin Jensen", party: "R", email: "kevin.jensen@sdlegislature.gov", chamber: "Senate" },
                { name: "Karla Lems", party: "R", email: "karla.lems@sdlegislature.gov", chamber: "House" },
                { name: "John Shubeck", party: "R", email: "john.shubeck@sdlegislature.gov", chamber: "House" },
            ]},
            17: { members: [
                { name: "Sydney Davis", party: "R", email: "sydney.davis@sdlegislature.gov", chamber: "Senate" },
                { name: "Chris Kassin", party: "R", email: "chris.kassin@sdlegislature.gov", chamber: "House" },
                { name: "William Shorma", party: "R", email: "william.shorma@sdlegislature.gov", chamber: "House" },
            ]},
            18: { members: [
                { name: "Lauren Nelson", party: "R", email: "lauren.nelson@sdlegislature.gov", chamber: "Senate" },
                { name: "Julie Auch", party: "R", email: "julie.auch@sdlegislature.gov", chamber: "House" },
                { name: "Mike Stevens", party: "R", email: "mike.stevens@sdlegislature.gov", chamber: "House" },
            ]},
            19: { members: [
                { name: "Kyle Schoenfish", party: "R", email: "kyle.schoenfish@sdlegislature.gov", chamber: "Senate" },
                { name: "Jessica Bahmuller", party: "R", email: "jessica.bahmuller@sdlegislature.gov", chamber: "House" },
                { name: "Drew Peterson", party: "R", email: "drew.peterson@sdlegislature.gov", chamber: "House" },
            ]},
            20: { members: [
                { name: "Paul Miskimins", party: "R", email: "paul.miskimins@sdlegislature.gov", chamber: "Senate" },
                { name: "Jeff Bathke", party: "R", email: "jeff.bathke@sdlegislature.gov", chamber: "House" },
                { name: "Kaley Nolz", party: "R", email: "kaley.nolz@sdlegislature.gov", chamber: "House" },
            ]},
            21: { members: [
                { name: "Marty Overweg", party: "R", email: "marty.overweg@sdlegislature.gov", chamber: "House" },
                { name: "Jim Halverson", party: "R", email: "jim.halverson@sdlegislature.gov", chamber: "House" },
                { name: "Mykala Voita", party: "R", email: "mykala.voita@sdlegislature.gov", chamber: "Senate" },
            ]},
            22: { members: [
                { name: "Lana Greenfield", party: "R", email: "lana.greenfield@sdlegislature.gov", chamber: "House" },
                { name: "Kevin Van Diepen", party: "R", email: "kevin.vandiepen@sdlegislature.gov", chamber: "House" },
                { name: "Brandon Wipf", party: "R", email: "brandon.wipf@sdlegislature.gov", chamber: "Senate" },
            ]},
            23: { members: [
                { name: "Mark Lapka", party: "R", email: "mark.lapka@sdlegislature.gov", chamber: "Senate" },
                { name: "Spencer Gosch", party: "R", email: "spencer.gosch@sdlegislature.gov", chamber: "House" },
                { name: "Scott Moore", party: "R", email: "scott.moore@sdlegislature.gov", chamber: "House" },
            ]},
            24: { members: [
                { name: "Jim Mehlhaff", party: "R", email: "jim.mehlhaff@sdlegislature.gov", chamber: "Senate" },
                { name: "Will Mortenson", party: "R", email: "will.mortenson@sdlegislature.gov", chamber: "House" },
                { name: "Mike Weisgram", party: "R", email: "mike.weisgram@sdlegislature.gov", chamber: "House" },
            ]},
            25: { members: [
                { name: "Tom Pischke", party: "R", email: "tom.pischke@sdlegislature.gov", chamber: "Senate" },
                { name: "Jon Hansen", party: "R", email: "jon.hansen@sdlegislature.gov", chamber: "House" },
                { name: "Leslie Heinemann", party: "R", email: "leslie.heinemann@sdlegislature.gov", chamber: "House" },
            ]},
            26: { members: [
                { name: "Tamara Grove", party: "R", email: "tamara.grove@sdlegislature.gov", chamber: "Senate" },
                { name: "Eric Emery", party: "D", email: "eric.emery@sdlegislature.gov", chamber: "House" },
                { name: "Rebecca Reimer", party: "R", email: "rebecca.reimer@sdlegislature.gov", chamber: "House" },
            ]},
            27: { members: [
                { name: "Red Dawn Foster", party: "D", email: "reddawn.foster@sdlegislature.gov", chamber: "Senate" },
                { name: "Liz May", party: "R", email: "liz.may@sdlegislature.gov", chamber: "House" },
                { name: "Peri Pourier", party: "D", email: "peri.pourier@sdlegislature.gov", chamber: "House" },
            ]},
            28: { members: [
                { name: "Sam Marty", party: "R", email: "sam.marty@sdlegislature.gov", chamber: "Senate" },
                { name: "Jana Hunt", party: "R", email: "jana.hunt@sdlegislature.gov", chamber: "House" },
                { name: "Travis Ismay", party: "R", email: "travis.ismay@sdlegislature.gov", chamber: "House" },
            ]},
            29: { members: [
                { name: "John Carley", party: "R", email: "john.carley@sdlegislature.gov", chamber: "Senate" },
                { name: "Terri Jorgenson", party: "R", email: "terri.jorgenson@sdlegislature.gov", chamber: "House" },
                { name: "Kathy Rice", party: "R", email: "kathy.rice@sdlegislature.gov", chamber: "House" },
            ]},
            30: { members: [
                { name: "Amber Hulse", party: "R", email: "amber.hulse@sdlegislature.gov", chamber: "Senate" },
                { name: "Tim Goodwin", party: "R", email: "tim.goodwin@sdlegislature.gov", chamber: "House" },
                { name: "Trish Ladner", party: "R", email: "trish.ladner@sdlegislature.gov", chamber: "House" },
            ]},
            31: { members: [
                { name: "Randy Deibert", party: "R", email: "randy.deibert@sdlegislature.gov", chamber: "Senate" },
                { name: "Mary Fitzgerald", party: "R", email: "mary.fitzgerald@sdlegislature.gov", chamber: "House" },
                { name: "Scott Odenbach", party: "R", email: "scott.odenbach@sdlegislature.gov", chamber: "House" },
            ]},
            32: { members: [
                { name: "Helene Duhamel", party: "R", email: "helene.duhamel@sdlegislature.gov", chamber: "Senate" },
                { name: "Steve Duffy", party: "R", email: "steve.duffy@sdlegislature.gov", chamber: "House" },
                { name: "Nicole Uhre-Balk", party: "D", email: "nicole.uhre-balk@sdlegislature.gov", chamber: "House" },
            ]},
            33: { members: [
                { name: "Curt Voight", party: "R", email: "curt.voight@sdlegislature.gov", chamber: "Senate" },
                { name: "Phil Jensen", party: "R", email: "phil.jensen@sdlegislature.gov", chamber: "House" },
                { name: "Curt Massie", party: "R", email: "curt.massie@sdlegislature.gov", chamber: "House" },
            ]},
            34: { members: [
                { name: "Taffy Howard", party: "R", email: "taffy.howard@sdlegislature.gov", chamber: "Senate" },
                { name: "Heather Baxter", party: "R", email: "heather.baxter@sdlegislature.gov", chamber: "House" },
                { name: "Mike Derby", party: "R", email: "mike.derby@sdlegislature.gov", chamber: "House" },
            ]},
            35: { members: [
                { name: "Tina Mulally", party: "R", email: "tina.mulally@sdlegislature.gov", chamber: "House" },
                { name: "Greg Blanc", party: "R", email: "greg.blanc@sdlegislature.gov", chamber: "Senate" },
                { name: "Tony Randolph", party: "R", email: "tony.randolph@sdlegislature.gov", chamber: "House" },
            ]},
        };

        // House Commerce & Energy Committee
        const committee = [
            { name: "Karla Lems", party: "R", email: "karla.lems@sdlegislature.gov", role: "Chair", district: 16 },
            { name: "Jessica Bahmuller", party: "R", email: "jessica.bahmuller@sdlegislature.gov", role: "Vice Chair", district: 19 },
            { name: "Aaron Aylward", party: "R", email: "aaron.aylward@sdlegislature.gov", role: "Member", district: 6 },
            { name: "Steve Duffy", party: "R", email: "steve.duffy@sdlegislature.gov", role: "Member", district: 32 },
            { name: "Lana Greenfield", party: "R", email: "lana.greenfield@sdlegislature.gov", role: "Member", district: 22 },
            { name: "Tony Kayser", party: "R", email: "tony.kayser@sdlegislature.gov", role: "Member", district: 14 },
            { name: "Tina Mulally", party: "R", email: "tina.mulally@sdlegislature.gov", role: "Member", district: 35 },
            { name: "Kaley Nolz", party: "R", email: "kaley.nolz@sdlegislature.gov", role: "Member", district: 20 },
            { name: "Drew Peterson", party: "R", email: "drew.peterson@sdlegislature.gov", role: "Member", district: 19 },
            { name: "Tesa Schwans", party: "R", email: "tesa.schwans@sdlegislature.gov", role: "Member", district: 9 },
            { name: "William Shorma", party: "R", email: "william.shorma@sdlegislature.gov", role: "Member", district: 17 },
            { name: "Mike Weisgram", party: "R", email: "mike.weisgram@sdlegislature.gov", role: "Member", district: 24 },
            { name: "Nicole Uhre-Balk", party: "D", email: "nicole.uhre-balk@sdlegislature.gov", role: "Member", district: 32 },
        ];

        // Message templates
        const templates = [
            {
                id: "subrogation",
                name: "Subrogation Rights",
                icon: "‚öñÔ∏è",
                desc: "Guts carriers' ability to recover from negligent utilities",
                getMessage: (leg, name, city, phone, agency) => `Dear ${leg.chamber === "Senate" ? "Senator" : "Representative"} ${leg.name.split(' ').pop()},

My name is ${name || '[Your Name]'}${agency ? `, and I am an insurance agent with ${agency}` : ''} in ${city || '[Your City]'}, South Dakota. I urge you to vote NO on SB 36.

As someone who works in insurance, I see firsthand how this bill harms policyholders. SB 36 effectively eliminates carriers' subrogation rights when utilities cause wildfires.

When a utility-caused fire destroys property, insurance pays the claim. Under current law, we can pursue the responsible utility to recover costs. This keeps premiums affordable and holds negligent parties accountable.

SB 36 creates a near-impossible burden of proof that makes recovery virtually impossible. Those costs get passed to policyholders through higher premiums or reduced coverage in fire-prone areas.

This bill protects utility shareholders at the expense of South Dakota families. Please vote NO on SB 36.

Sincerely,
${name || '[Your Name]'}${agency ? '\n' + agency : ''}
${city ? city + ', SD' : '[Your City, SD]'}${phone ? '\n' + phone : ''}`
            },
            {
                id: "premiums",
                name: "Premium Impact",
                icon: "üí∞",
                desc: "Shifts costs to policyholders via higher rates",
                getMessage: (leg, name, city, phone, agency) => `Dear ${leg.chamber === "Senate" ? "Senator" : "Representative"} ${leg.name.split(' ').pop()},

I am ${name || '[Your Name]'}${agency ? ` with ${agency}` : ''}, writing from ${city || '[Your City]'} to oppose SB 36.

This bill will directly increase insurance costs for South Dakota homeowners and businesses.

When utilities cause wildfires and insurance pays claims, carriers currently recover costs from the responsible party. SB 36 makes that nearly impossible by capping damages and creating an unreasonable burden of proof.

Those unrecovered costs spread across all policyholders through higher premiums. In fire-prone areas, coverage may become unaffordable or unavailable.

We've seen this in western states with similar legislation. California's insurance crisis is a cautionary tale. South Dakota shouldn't follow that path.

Please protect consumers and vote NO on SB 36.

Respectfully,
${name || '[Your Name]'}${agency ? '\n' + agency : ''}
${city ? city + ', SD' : '[Your City, SD]'}${phone ? '\n' + phone : ''}`
            },
            {
                id: "accountability",
                name: "Utility Accountability",
                icon: "üîå",
                desc: "Removes incentive for utilities to maintain safe infrastructure",
                getMessage: (leg, name, city, phone, agency) => `Dear ${leg.chamber === "Senate" ? "Senator" : "Representative"} ${leg.name.split(' ').pop()},

My name is ${name || '[Your Name]'}${agency ? ` from ${agency}` : ''} in ${city || '[Your City]'}. I urge you to oppose SB 36.

This bill removes a critical incentive for utilities to maintain safe infrastructure. Under current law, if a utility's negligence causes a wildfire, they face strict liability. This motivates investment in maintenance and equipment upgrades.

SB 36 lets utilities file a "mitigation plan" and eliminates strict liability. The message: file paperwork and you're shielded when your equipment starts fires.

Who pays when accountability disappears? Insurance carriers absorb immediate costs, but South Dakota policyholders bear the burden through higher premiums.

Utilities are monopolies - ratepayers can't switch. The least we can do is hold them accountable for negligence. Please vote NO on SB 36.

Thank you,
${name || '[Your Name]'}${agency ? '\n' + agency : ''}
${city ? city + ', SD' : '[Your City, SD]'}${phone ? '\n' + phone : ''}`
            },
            {
                id: "victims",
                name: "Victim Rights",
                icon: "üè†",
                desc: "Makes it nearly impossible for victims to recover damages",
                getMessage: (leg, name, city, phone, agency) => `Dear ${leg.chamber === "Senate" ? "Senator" : "Representative"} ${leg.name.split(' ').pop()},

I am ${name || '[Your Name]'}${agency ? `, an insurance agent with ${agency}` : ''}, writing to oppose SB 36.

This bill is devastating for wildfire victims. It creates a near-impossible burden of proof for recovering damages from utilities that cause fires. Even when faulty equipment clearly started the blaze, victims face capped damages and procedural hurdles designed to protect utilities.

Insurance helps, but policies have limits. When families lose everything in a utility-caused fire, they deserve their day in court - not a system rigged against them.

SB 36 is part of a coordinated utility industry push through western states. It benefits shareholders at the expense of families they're supposed to serve.

South Dakota should protect its citizens. Please vote NO on SB 36.

Sincerely,
${name || '[Your Name]'}${agency ? '\n' + agency : ''}
${city ? city + ', SD' : '[Your City, SD]'}${phone ? '\n' + phone : ''}`
            },
            {
                id: "market",
                name: "Market Stability",
                icon: "üìä",
                desc: "Threatens stability of SD's property insurance market",
                getMessage: (leg, name, city, phone, agency) => `Dear ${leg.chamber === "Senate" ? "Senator" : "Representative"} ${leg.name.split(' ').pop()},

My name is ${name || '[Your Name]'}${agency ? ` with ${agency}` : ''} in ${city || '[Your City]'}, and I'm writing as an insurance agent to oppose SB 36.

This bill would destabilize South Dakota's property insurance market. By eliminating strict liability and capping damages for utility-caused wildfires, SB 36 shifts massive potential losses onto insurers with no path to recovery.

The industry response is predictable: rate increases, coverage restrictions, and in severe cases, market withdrawal from high-risk areas. We've watched this unfold elsewhere.

South Dakota's insurance market is currently stable and competitive. SB 36 threatens that by forcing insurers to absorb losses that should be borne by negligent utilities.

Please protect our market and policyholders. Vote NO on SB 36.

Respectfully,
${name || '[Your Name]'}${agency ? '\n' + agency : ''}
${city ? city + ', SD' : '[Your City, SD]'}${phone ? '\n' + phone : ''}`
            }
        ];

        function App() {
            const [step, setStep] = useState(1);
            const [mode, setMode] = useState(null); // 'committee' or 'district'
            const [district, setDistrict] = useState(null);
            const [selected, setSelected] = useState([]);
            const [template, setTemplate] = useState(null);
            const [firstName, setFirstName] = useState('');
            const [lastName, setLastName] = useState('');
            const [city, setCity] = useState('');
            const [phone, setPhone] = useState('');
            const [agency, setAgency] = useState('');
            const [error, setError] = useState('');
            const [loading, setLoading] = useState(false);
            const [sending, setSending] = useState(false);
            const [matchedAddr, setMatchedAddr] = useState('');

            const inputRef = useRef(null);
            const acRef = useRef(null);
            const fullName = [firstName, lastName].filter(Boolean).join(' ');

            // Google Places
            useEffect(() => {
                if (!inputRef.current || !window.google || acRef.current) return;
                const bounds = new window.google.maps.LatLngBounds(
                    new window.google.maps.LatLng(42.4, -104.5),
                    new window.google.maps.LatLng(46.0, -96.4)
                );
                acRef.current = new window.google.maps.places.Autocomplete(inputRef.current, {
                    types: ['address'],
                    componentRestrictions: { country: 'us' },
                    bounds,
                    strictBounds: true,
                    fields: ['formatted_address', 'geometry', 'address_components']
                });
                acRef.current.addListener('place_changed', async () => {
                    const place = acRef.current.getPlace();
                    if (!place.geometry) { setError('Select an address from dropdown'); return; }
                    const state = place.address_components?.find(c => c.types.includes('administrative_area_level_1'));
                    if (state?.short_name !== 'SD') { setError('Please enter a South Dakota address'); return; }
                    const cityComp = place.address_components?.find(c => c.types.includes('locality'));
                    if (cityComp) setCity(cityComp.long_name);
                    setMatchedAddr(place.formatted_address);
                    await lookupDistrict(place.geometry.location.lat(), place.geometry.location.lng());
                });
            }, [mode]);

            const lookupDistrict = async (lat, lng) => {
                setLoading(true);
                setError('');
                try {
                    const url = `https://tigerweb.geo.census.gov/arcgis/rest/services/TIGERweb/Legislative/MapServer/identify?geometry=${lng},${lat}&geometryType=esriGeometryPoint&sr=4326&layers=all:1&tolerance=0&mapExtent=-104,43,-96,46&imageDisplay=800,600,96&returnGeometry=false&f=json`;
                    const res = await fetch(url);
                    const data = await res.json();
                    if (data.results?.length > 0) {
                        const num = parseInt(data.results[0].attributes.BASENAME || data.results[0].attributes.NAME, 10);
                        if (legislators[num]) { setDistrict(num); }
                        else { setError(`District ${num} not found.`); }
                    } else { setError('Could not determine district.'); }
                } catch { setError('Error looking up district.'); }
                setLoading(false);
            };

            const toggle = (leg) => {
                const id = leg.email;
                if (selected.find(l => l.email === id)) {
                    setSelected(selected.filter(l => l.email !== id));
                } else {
                    setSelected([...selected, leg]);
                }
            };

            const isSelected = (leg) => selected.some(l => l.email === leg.email);

            const selectAllCommittee = () => {
                const all = committee.every(m => isSelected(m));
                setSelected(all ? [] : [...committee]);
            };

            const sendEmails = () => {
                setSending(true);
                selected.forEach((leg, i) => {
                    setTimeout(() => {
                        const msg = template.getMessage(leg, fullName, city, phone, agency);
                        const subj = encodeURIComponent('Opposition to SB 36 - Utility Wildfire Liability');
                        window.open(`mailto:${leg.email}?subject=${subj}&body=${encodeURIComponent(msg)}`, '_blank');
                    }, i * 700);
                });
                setTimeout(() => setSending(false), selected.length * 700 + 500);
            };

            const reset = () => {
                setStep(1);
                setMode(null);
                setDistrict(null);
                setSelected([]);
                setTemplate(null);
                setFirstName('');
                setLastName('');
                setCity('');
                setPhone('');
                setAgency('');
                setMatchedAddr('');
                setError('');
            };

            const districtData = district ? legislators[district] : null;

            return (
                <div className="app-container">
                    <header className="header">
                        <span className="bill-badge">OPPOSE SB 36</span>
                        <h1>Stop SB 36</h1>
                        <p>Insurance agents: Take 2 minutes to tell legislators why this bill hurts policyholders.</p>
                    </header>

                    <div className="alert-box">
                        <strong>Why agents should care:</strong> SB 36 guts subrogation. When utilities cause fires, carriers pay claims but can't recover from the responsible party. That cost lands on <strong>your policyholders</strong> via higher premiums.
                    </div>

                    <div className="steps">
                        <div className={`step ${step >= 1 ? 'active' : ''} ${step > 1 ? 'completed' : ''}`}>
                            <span className="step-num">1</span> Select
                        </div>
                        <div className={`step ${step >= 2 ? 'active' : ''} ${step > 2 ? 'completed' : ''}`}>
                            <span className="step-num">2</span> Message
                        </div>
                        <div className={`step ${step >= 3 ? 'active' : ''}`}>
                            <span className="step-num">3</span> Send
                        </div>
                    </div>

                    {/* Step 1 */}
                    {step === 1 && (
                        <div className="card">
                            <div className="card-header">
                                <h2>Who do you want to contact?</h2>
                            </div>

                            <div className="tab-row">
                                <button className={`tab-btn ${mode === 'committee' ? 'active' : ''}`} onClick={() => { setMode('committee'); setSelected([]); setDistrict(null); }}>
                                    üèõÔ∏è Commerce & Energy Committee
                                </button>
                                <button className={`tab-btn ${mode === 'district' ? 'active' : ''}`} onClick={() => { setMode('district'); setSelected([]); }}>
                                    üìç My District Legislators
                                </button>
                            </div>

                            {mode === 'committee' && (
                                <>
                                    <div className="select-row">
                                        <button className="select-all-btn" onClick={selectAllCommittee}>
                                            {committee.every(m => isSelected(m)) ? '‚òê Deselect All' : '‚òë Select All 13'}
                                        </button>
                                        <span style={{ color: 'var(--text-mid)' }}>{selected.length} selected</span>
                                    </div>
                                    <div className="committee-grid">
                                        {committee.map((m, i) => (
                                            <div key={i} className={`member-chip ${isSelected(m) ? 'selected' : ''}`} onClick={() => toggle(m)}>
                                                <div className="chip-check">{isSelected(m) && '‚úì'}</div>
                                                <div className="chip-info">
                                                    <div className="chip-name">{m.name}</div>
                                                    <div className="chip-role">
                                                        {m.role !== 'Member' ? m.role : `District ${m.district}`} ‚Ä¢ {m.party}
                                                    </div>
                                                </div>
                                            </div>
                                        ))}
                                    </div>
                                </>
                            )}

                            {mode === 'district' && !district && (
                                <>
                                    <div className="form-group">
                                        <label>Your Office Address</label>
                                        <input ref={inputRef} type="text" placeholder="Start typing..." disabled={loading} />
                                        {error && <div className="error-message">{error}</div>}
                                        {loading && <div className="input-hint"><div className="spinner" style={{ display: 'inline-block', width: 16, height: 16, marginRight: 8, verticalAlign: 'middle' }}></div>Looking up district...</div>}
                                    </div>
                                    <div className="form-group">
                                        <label>Or select district</label>
                                        <select defaultValue="" onChange={(e) => {
                                            const n = parseInt(e.target.value);
                                            if (n && legislators[n]) { setDistrict(n); setMatchedAddr(`District ${n}`); }
                                        }}>
                                            <option value="" disabled>Choose...</option>
                                            {Array.from({length: 35}, (_, i) => i + 1).map(n => (
                                                <option key={n} value={n}>District {n} - {legislators[n]?.members.map(m => m.name.split(' ').pop()).join(', ')}</option>
                                            ))}
                                        </select>
                                    </div>
                                </>
                            )}

                            {mode === 'district' && district && districtData && (
                                <>
                                    <div className="district-badge">üìç District {district}</div>
                                    {matchedAddr && <div className="input-hint" style={{ marginBottom: '0.75rem' }}>{matchedAddr}</div>}
                                    <div className="district-grid">
                                        {districtData.members.map((m, i) => (
                                            <div key={i} className={`leg-card ${isSelected(m) ? 'selected' : ''}`} onClick={() => toggle(m)}>
                                                <div className="leg-avatar">{m.name.split(' ').map(n => n[0]).join('')}</div>
                                                <div className="leg-info">
                                                    <div className="leg-name">{m.name}</div>
                                                    <div className="leg-role">State {m.chamber === 'Senate' ? 'Senator' : 'Representative'}</div>
                                                </div>
                                                <span className="leg-party">{m.party}</span>
                                            </div>
                                        ))}
                                    </div>
                                    <div className="reset-link" onClick={() => { setDistrict(null); setSelected([]); setMatchedAddr(''); }}>Change district</div>
                                </>
                            )}

                            {mode && (mode === 'committee' || district) && (
                                <div className="nav-row">
                                    <button className="btn btn-primary" onClick={() => setStep(2)} disabled={selected.length === 0}>
                                        Continue with {selected.length} ‚Üí
                                    </button>
                                </div>
                            )}
                        </div>
                    )}

                    {/* Step 2 */}
                    {step === 2 && (
                        <div className="card">
                            <div className="card-header">
                                <h2>Choose your message focus</h2>
                                <p>All templates oppose SB 36. Pick the angle that fits you.</p>
                            </div>

                            <div className="template-grid">
                                {templates.map(t => (
                                    <div key={t.id} className={`template-card ${template?.id === t.id ? 'selected' : ''}`} onClick={() => setTemplate(t)}>
                                        <div className="template-icon">{t.icon}</div>
                                        <div className="template-name">{t.name}</div>
                                        <div className="template-desc">{t.desc}</div>
                                    </div>
                                ))}
                            </div>

                            <div className="nav-row">
                                <button className="btn btn-secondary" onClick={() => setStep(1)}>‚Üê Back</button>
                                <button className="btn btn-primary" onClick={() => setStep(3)} disabled={!template}>Continue ‚Üí</button>
                            </div>
                        </div>
                    )}

                    {/* Step 3 */}
                    {step === 3 && (
                        <div className="card">
                            <div className="card-header">
                                <h2>Your info & send</h2>
                            </div>

                            <div className="form-row">
                                <div className="form-group">
                                    <label>First Name *</label>
                                    <input type="text" value={firstName} onChange={e => setFirstName(e.target.value)} placeholder="First" />
                                </div>
                                <div className="form-group">
                                    <label>Last Name *</label>
                                    <input type="text" value={lastName} onChange={e => setLastName(e.target.value)} placeholder="Last" />
                                </div>
                            </div>

                            <div className="form-row">
                                <div className="form-group">
                                    <label>City *</label>
                                    <input type="text" value={city} onChange={e => setCity(e.target.value)} placeholder="Your city" />
                                </div>
                                <div className="form-group">
                                    <label>Your Agency *</label>
                                    <input type="text" value={agency} onChange={e => setAgency(e.target.value)} placeholder="Agency name" />
                                </div>
                            </div>

                            <div className="form-group">
                                <label>Phone (optional)</label>
                                <input type="tel" value={phone} onChange={e => setPhone(e.target.value)} placeholder="(605) 555-1234" />
                            </div>

                            <div style={{ marginBottom: '1rem' }}>
                                <label style={{ fontWeight: 600, fontSize: '0.9rem', marginBottom: '0.5rem', display: 'block' }}>Sending to:</label>
                                <div className="recipients-row">
                                    {selected.map(l => (
                                        <span key={l.email} className="recipient-chip">{l.name.split(' ').pop()}</span>
                                    ))}
                                </div>
                            </div>

                            <details>
                                <summary style={{ cursor: 'pointer', fontSize: '0.85rem', color: 'var(--blue-pro)', fontWeight: 500 }}>Preview message</summary>
                                <div className="preview-box">
                                    {template?.getMessage(selected[0] || { name: 'Legislator', chamber: 'House' }, fullName || '[Name]', city || '[City]', phone, agency)}
                                </div>
                            </details>

                            <button className="btn btn-send" onClick={sendEmails} disabled={sending || !fullName || !city || !agency} style={{ marginTop: '1rem' }}>
                                {sending ? 'Opening emails...' : `üìß Send ${selected.length} Email${selected.length > 1 ? 's' : ''}`}
                            </button>
                            <div className="input-hint" style={{ textAlign: 'center', marginTop: '0.5rem' }}>
                                Opens your email client with message ready to send
                            </div>

                            <div className="nav-row">
                                <button className="btn btn-secondary" onClick={() => setStep(2)}>‚Üê Back</button>
                            </div>

                            <div className="reset-link" onClick={reset}>Start over</div>
                        </div>
                    )}

                    <footer>
                        Not affiliated with the SD Legislature. Data from <a href="https://sdlegislature.gov" target="_blank">sdlegislature.gov</a>
                    </footer>
                </div>
            );
        }

        ReactDOM.createRoot(document.getElementById('root')).render(<App />);
    </script>
</body>
</html>
